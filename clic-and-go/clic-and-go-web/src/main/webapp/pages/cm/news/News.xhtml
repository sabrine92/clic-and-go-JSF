<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<script src="http://maps.google.com/maps/api/js?sensor=true|false"
		type="text/javascript"></script>
</h:head>
<body>
	<p:growl id="messages" showDetail="true" />

	<p:gmap id="gmap" center="36.803660, 10.180010" zoom="13" type="HYBRID"
		style="width:70%;height:400px" model="#{newsBean.simpleModel}"
		onPointClick="handlePointClick(event);" widgetVar="map" />

	<p:dialog widgetVar="dlg" showEffect="fade">
		<h:form prependId="false">
			<h:panelGrid columns="2">
				<h:outputLabel for="title" value="Title:" />
				<p:inputText id="title" value="#{newsBean.news.title}" />
				<h:outputLabel for="descr" value="Description:" />
				<p:inputText id="descr" value="#{newsBean.news.description}" />
				<h:outputLabel for="type" value="Type:" />
				<p:inputText id="type" value="#{newsBean.news.type}" />

				<f:facet name="footer">
					<p:commandButton value="Add" actionListener="#{newsBean.addMarker}"
						update=":messages" oncomplete="markerAddComplete()" />
					<p:commandButton value="Cancel" onclick="return cancel()" />
				</f:facet>
			</h:panelGrid>

			<h:inputHidden id="lat" value="#{newsBean.lat}" />
			<h:inputHidden id="lng" value="#{newsBean.lng}" />
		</h:form>
	</p:dialog>

	<script type="text/javascript">
    var currentMarker = null;
 
    function handlePointClick(event) {
        if(currentMarker === null) {
            document.getElementById('lat').value = event.latLng.lat();
            document.getElementById('lng').value = event.latLng.lng();
 
            currentMarker = new google.maps.Marker({
                position:new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
            });
 
            PF('map').addOverlay(currentMarker);
 
            PF('dlg').show();
        }   
    }
 
    function markerAddComplete() {
        var title = document.getElementById('title');
        currentMarker.setTitle(title.value);
        title.value = "";
 
        currentMarker = null;
        PF('dlg').hide();
    }
 
    function cancel() {
        PF('dlg').hide();
        currentMarker.setMap(null);
        currentMarker = null;
 
        return false;
    }
</script>
</body>
</html>
